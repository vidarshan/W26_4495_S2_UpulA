generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                  String        @id @default(uuid())
  name                String
  email               String        @unique
  role                Role
  createdAt           DateTime      @default(now())
  password            String
  appointmentsAsStaff Appointment[] @relation("StaffAppointments")
}

model Client {
  id               String        @id @default(uuid())
  title            String?
  firstName        String
  lastName         String
  companyName      String?
  email            String
  phone            String
  preferredContact String
  leadSource       String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  addresses        Address[]
  appointments     Appointment[]
  notes            ClientNote[]
}

model ClientNote {
  id        String   @id @default(uuid())
  clientId  String
  content   String
  createdAt DateTime @default(now())
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

model Address {
  id           String        @id @default(uuid())
  clientId     String
  street1      String
  street2      String?
  city         String
  province     String
  postalCode   String
  country      String
  isPrimary    Boolean       @default(false)
  isBilling    Boolean       @default(false)
  createdAt    DateTime      @default(now())
  client       Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  appointments Appointment[]
}

model Appointment {
  id             String            @id @default(uuid())
  startTime      DateTime          @db.Timestamptz(6)
  endTime        DateTime          @db.Timestamptz(6)
  status         AppointmentStatus
  clientId       String
  staffId        String
  createdAt      DateTime          @default(now()) @db.Timestamptz(6)
  completionSent Boolean           @default(false)
  price          Float?
  reminder1dSent Boolean           @default(false)
  reminder5dSent Boolean           @default(false)
  addressId      String
  address        Address           @relation(fields: [addressId], references: [id])
  client         Client            @relation(fields: [clientId], references: [id])
  staff          User              @relation("StaffAppointments", fields: [staffId], references: [id])
  notes          VisitNote[]
}

model VisitNote {
  id              String      @id @default(uuid())
  content         String
  isClientVisible Boolean     @default(false)
  appointmentId   String
  createdAt       DateTime    @default(now())
  appointment     Appointment @relation(fields: [appointmentId], references: [id])
}

enum Role {
  ADMIN
  STAFF
  CLIENT
}

enum AppointmentStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  LATE
}
